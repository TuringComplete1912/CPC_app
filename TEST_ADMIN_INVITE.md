# 管理员邀请码功能测试指南

## 🧪 测试步骤

### 测试1: 使用管理员邀请码注册

1. **启动应用**
   ```bash
   npm run dev
   ```

2. **访问注册页面**
   - 打开浏览器访问: http://localhost:3001/register

3. **填写注册信息**
   - 用户名: `测试管理员`
   - 密码: `123456`
   - 确认密码: `123456`
   - 邀请码: `admin6`

4. **提交注册**
   - 点击"注册"按钮
   - 应该看到提示: "注册成功！您已获得管理员权限，请使用新账号登录"

5. **登录验证**
   - 使用新账号登录
   - 访问"党务管理"页面
   - 应该自动跳转到管理员页面 `/party/admin`
   - 可以看到所有用户的党务信息

6. **权限验证**
   - 在社区、文档、活动日志中
   - 应该可以看到删除按钮
   - 可以删除任何用户的内容

### 测试2: 使用普通邀请码注册

1. **访问注册页面**
   - http://localhost:3001/register

2. **填写注册信息**
   - 用户名: `测试用户`
   - 密码: `123456`
   - 确认密码: `123456`
   - 邀请码: `branch6`

3. **提交注册**
   - 点击"注册"按钮
   - 应该看到提示: "注册成功！请使用新账号登录"

4. **登录验证**
   - 使用新账号登录
   - 访问"党务管理"页面
   - 应该停留在普通用户页面 `/party`
   - 只能看到自己的党务信息

5. **权限验证**
   - 在社区、文档、活动日志中
   - 只能删除自己创建的内容
   - 不能删除其他用户的内容

### 测试3: 使用错误邀请码

1. **访问注册页面**
   - http://localhost:3001/register

2. **填写注册信息**
   - 用户名: `测试错误`
   - 密码: `123456`
   - 确认密码: `123456`
   - 邀请码: `wrongcode`

3. **提交注册**
   - 点击"注册"按钮
   - 应该看到错误提示: "邀请码错误"
   - 无法注册

### 测试4: 验证数据库

1. **查看管理员列表**
   ```bash
   npx tsx prisma/check-status.ts
   ```

2. **预期结果**
   - 应该看到"测试管理员"在管理员列表中
   - role 字段应该是 "admin"

3. **查看所有用户**
   ```bash
   npx prisma studio
   ```
   - 打开 User 表
   - 找到"测试管理员"
   - 确认 role 字段为 "admin"
   - 找到"测试用户"
   - 确认 role 字段为 "member"

## ✅ 预期结果

### 管理员邀请码 (admin6)
- ✅ 注册成功提示包含"管理员权限"
- ✅ 数据库中 role 字段为 "admin"
- ✅ 登录后可以访问管理员页面
- ✅ 可以删除任何用户的内容
- ✅ 可以查看所有用户的党务信息

### 普通邀请码 (branch6)
- ✅ 注册成功提示不包含"管理员权限"
- ✅ 数据库中 role 字段为 "member"
- ✅ 登录后只能访问普通用户页面
- ✅ 只能删除自己的内容
- ✅ 只能查看自己的党务信息

### 错误邀请码
- ✅ 显示"邀请码错误"提示
- ✅ 无法注册
- ✅ 数据库中没有创建用户

## 🐛 常见问题排查

### 问题1: 注册后没有管理员权限

**检查步骤**:
1. 确认使用的邀请码是 `admin6`（区分大小写）
2. 查看数据库中用户的 role 字段
3. 重新登录尝试

**解决方法**:
```bash
# 手动设置为管理员
npx tsx prisma/set-admins.ts
```

### 问题2: 邀请码验证失败

**检查步骤**:
1. 确认邀请码拼写正确
2. 检查是否有多余的空格
3. 确认大小写正确

### 问题3: 注册成功但无法登录

**检查步骤**:
1. 确认密码输入正确
2. 检查用户名是否已存在
3. 查看浏览器控制台错误信息

## 📊 测试清单

- [ ] 使用 `admin6` 注册成功
- [ ] 管理员账号可以访问 `/party/admin`
- [ ] 管理员可以删除任何内容
- [ ] 使用 `branch6` 注册成功
- [ ] 普通用户只能访问 `/party`
- [ ] 普通用户只能删除自己的内容
- [ ] 错误邀请码无法注册
- [ ] 数据库中 role 字段正确
- [ ] 注册提示信息正确
- [ ] 权限立即生效

## 🎯 测试完成

完成所有测试后，您应该确认：
1. ✅ 管理员邀请码功能正常工作
2. ✅ 权限设置正确
3. ✅ 安全验证有效
4. ✅ 用户体验良好

如果所有测试都通过，说明功能已经完美实现！

# 文件和板块删除功能

## 功能概述

为学习园地添加了完整的文件和板块删除功能，包含权限控制和安全确认机制。

## 主要功能

### 1. 文件删除
- ✅ 每个上传的文件都有删除选项
- ✅ 删除后服务器同步删除物理文件，释放存储空间
- ✅ 每个人只能删除自己上传的文件
- ✅ 管理员可以删除任意文件

### 2. 板块删除
- ✅ 板块创建者可以删除自己创建的板块
- ✅ 如果板块中有他人上传的文件，创建者无法删除
- ✅ 管理员可以删除任意板块（包括有他人文件的板块）
- ✅ 删除板块时会级联删除所有关联的文件和数据

### 3. 安全确认机制
- ✅ 删除操作需要手动输入"确定移除"进行确认
- ✅ 显示红色警告提示：此操作无法恢复
- ✅ 显示要删除的项目名称
- ✅ 只有输入正确的确认文本才能执行删除

## 技术实现

### API路由

1. **DELETE /api/materials/[id]** - 删除材料文件
   - 权限检查：上传者或管理员
   - 删除服务器文件
   - 删除数据库记录

2. **DELETE /api/categories/[id]** - 删除板块
   - 权限检查：创建者或管理员
   - 检查是否有他人文件（非管理员）
   - 删除所有关联文件
   - 级联删除数据库记录

3. **DELETE /api/upload/[id]** - 删除上传文件
   - 权限检查：上传者或管理员
   - 删除服务器文件
   - 删除数据库记录

### 组件

- **ConfirmDeleteDialog** - 通用删除确认对话框
  - 需要手动输入确认文本
  - 显示警告信息
  - 支持自定义标题和描述

### 数据库变更

- 添加了 `onDelete: Cascade` 到 Material 模型
- 删除板块时自动级联删除关联的材料记录

## 权限矩阵

| 操作 | 普通用户 | 创建者/上传者 | 管理员 |
|------|---------|--------------|--------|
| 删除自己的文件 | ✅ | ✅ | ✅ |
| 删除他人的文件 | ❌ | ❌ | ✅ |
| 删除自己创建的空板块 | ❌ | ✅ | ✅ |
| 删除自己创建的有他人文件的板块 | ❌ | ❌ | ✅ |
| 删除他人创建的板块 | ❌ | ❌ | ✅ |

## 用户体验

1. **视觉反馈**
   - 删除按钮在鼠标悬停时显示（opacity transition）
   - 红色主题表示危险操作
   - 清晰的图标（垃圾桶）

2. **交互流程**
   - 点击删除按钮 → 弹出确认对话框
   - 阅读警告信息 → 输入"确定移除"
   - 确认删除 → 执行删除操作
   - 自动刷新列表

3. **错误处理**
   - 权限不足时显示友好提示
   - 文件不存在时返回404
   - 服务器错误时显示错误信息

## 安全性

- ✅ 所有API都需要登录认证
- ✅ 严格的权限检查
- ✅ 防止误删的确认机制
- ✅ 服务器端验证所有操作
- ✅ 物理文件和数据库记录同步删除

## 使用说明

### 删除文件
1. 进入板块详情页
2. 找到要删除的文件
3. 鼠标悬停显示删除按钮
4. 点击删除按钮
5. 在对话框中输入"确定移除"
6. 点击确认删除

### 删除板块
1. 进入学习园地主页
2. 找到要删除的板块
3. 鼠标悬停显示删除按钮
4. 点击删除按钮
5. 在对话框中输入"确定移除"
6. 点击确认删除

## 注意事项

⚠️ **重要提示**
- 删除操作无法恢复
- 删除板块会同时删除其中的所有文件
- 普通用户无法删除包含他人文件的板块
- 管理员拥有完全的删除权限

# 管理员邀请码功能说明

## 📋 功能概述

系统现在支持两种邀请码注册：
1. **普通用户邀请码**: `branch6` - 注册为普通用户
2. **管理员邀请码**: `admin6` - 注册为管理员，自动获得所有管理员权限

## 🔑 邀请码说明

### 普通用户邀请码
- **邀请码**: `branch6`
- **权限**: 普通用户权限
- **功能**: 
  - 查看和参与社区讨论
  - 查看文档和活动日志
  - 查看学习资料
  - 填写个人党务信息
  - 查找同年/同阶段同志

### 管理员邀请码
- **邀请码**: `admin6`
- **权限**: 管理员权限
- **功能**: 
  - 所有普通用户功能
  - 删除任何用户的话题、回答、文档、活动日志
  - 管理学习资料分类
  - 查看所有用户的党务信息（包括隐私信息）
  - 管理党务信息（搜索、排序、统计）
  - 删除理论学习分类

## 📝 使用方法

### 注册管理员账号

1. **访问注册页面**
   - 打开应用
   - 点击"注册"按钮

2. **填写注册信息**
   - 用户名: 输入您的用户名
   - 密码: 至少6位
   - 确认密码: 再次输入密码
   - 邀请码: 输入 `admin6`

3. **提交注册**
   - 点击"注册"按钮
   - 系统会提示"注册成功！您已获得管理员权限，请使用新账号登录"

4. **登录使用**
   - 使用新注册的账号登录
   - 自动享有所有管理员权限

## ✅ 验证管理员权限

注册成功后，您可以通过以下方式验证管理员权限：

1. **访问党务管理**
   - 点击顶部导航栏"党务管理"
   - 管理员会自动跳转到管理员页面
   - 可以查看所有用户的党务信息

2. **删除权限**
   - 在社区、文档、活动日志中
   - 可以看到删除按钮（红色垃圾桶图标）
   - 可以删除任何用户的内容

3. **管理分类**
   - 在学习园地中
   - 可以删除理论学习分类
   - 可以管理所有分类

## 🔒 安全说明

### 邀请码保护
- 管理员邀请码应该严格保密
- 只分享给需要管理员权限的可信任人员
- 建议定期更换邀请码（需要修改代码）

### 更换邀请码
如需更换管理员邀请码，需要修改以下文件：

1. **前端**: `src/app/register/page.tsx`
   ```typescript
   const ADMIN_INVITE_CODE = "admin6"; // 修改这里
   ```

2. **后端**: `src/app/api/register/route.ts`
   ```typescript
   const ADMIN_INVITE_CODE = "admin6"; // 修改这里
   ```

## 📊 当前管理员列表

运行以下命令查看当前所有管理员：

```bash
npx tsx prisma/check-status.ts
```

或者使用管理员设置工具：

```bash
npx tsx prisma/set-admins.ts
```

## 🎯 使用场景

### 场景1: 新管理员加入
1. 将管理员邀请码 `admin6` 告知新管理员
2. 新管理员使用邀请码注册
3. 自动获得管理员权限
4. 无需手动运行脚本设置权限

### 场景2: 临时管理员
1. 使用管理员邀请码注册临时账号
2. 完成管理任务
3. 如需撤销权限，可以通过数据库修改 role 字段

### 场景3: 批量添加管理员
1. 分享管理员邀请码给多个人
2. 他们各自注册
3. 自动获得管理员权限

## ⚠️ 注意事项

1. **邀请码验证**: 
   - 前端和后端都会验证邀请码
   - 必须完全匹配才能注册成功

2. **权限立即生效**: 
   - 使用管理员邀请码注册后
   - 权限立即生效，无需等待

3. **不影响现有用户**: 
   - 现有的管理员（李明昊、尚冠竹）权限不受影响
   - 可以继续使用原有账号

4. **邀请码区分大小写**: 
   - `admin6` 和 `Admin6` 是不同的
   - 请确保输入正确

## 🔧 技术实现

### 注册流程

```
用户输入邀请码
    ↓
前端验证邀请码
    ↓
发送到后端 API
    ↓
后端再次验证邀请码
    ↓
根据邀请码设置 role
    ↓
创建用户（role: "admin" 或 "member"）
    ↓
返回注册结果
```

### 代码位置

- **前端页面**: `src/app/register/page.tsx`
- **后端API**: `src/app/api/register/route.ts`
- **邀请码常量**: 
  - 普通用户: `branch6`
  - 管理员: `admin6`

## 📞 常见问题

**Q: 忘记管理员邀请码怎么办？**
A: 查看本文档或联系系统管理员

**Q: 可以修改邀请码吗？**
A: 可以，修改前后端代码中的 `ADMIN_INVITE_CODE` 常量

**Q: 使用错误的邀请码会怎样？**
A: 系统会提示"邀请码错误"，无法注册

**Q: 可以撤销管理员权限吗？**
A: 可以，通过数据库修改用户的 role 字段为 "member"

**Q: 管理员邀请码会过期吗？**
A: 不会，除非手动修改代码更换邀请码

## 🎉 总结

管理员邀请码功能让添加新管理员变得更加简单：
- ✅ 无需手动运行脚本
- ✅ 权限立即生效
- ✅ 安全可控
- ✅ 易于使用

只需分享邀请码 `admin6`，新管理员即可自助注册并获得完整权限！

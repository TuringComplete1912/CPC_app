# 文档和活动日志功能

## 功能概述

为工作台添加了完整的文档和活动日志编辑功能，支持协作编辑、草稿保存和发布流程。

## 主要功能

### 1. 近期文档
- ✅ 创建、编辑、查看和删除文档
- ✅ 富文本编辑器（支持Markdown格式）
- ✅ 草稿状态：所有人都可以协作编辑
- ✅ 发布后不可修改
- ✅ 显示参与编辑的所有用户
- ✅ 发布前提示"发布后无法修改"

### 2. 活动日志
- ✅ 创建、编辑、查看和删除活动日志
- ✅ 富文本编辑器（支持Markdown格式）
- ✅ 草稿状态：所有人都可以协作编辑
- ✅ 发布后不可修改
- ✅ 显示参与编辑的所有用户
- ✅ 发布前提示"发布后无法修改"
- ✅ 预置了"2025/12/27 飞盘活动"草稿

### 3. 富文本编辑器
- ✅ 工具栏：粗体、斜体、列表、链接等
- ✅ Markdown语法支持
- ✅ 字数统计
- ✅ 自动保存草稿
- ✅ 禁用状态（已发布内容）

### 4. 协作编辑
- ✅ 草稿状态下所有用户都可以编辑
- ✅ 自动记录编辑者和编辑时间
- ✅ 发布时显示所有参与编辑的用户
- ✅ 实时显示协作编辑状态

## 数据库模型

### Document（文档）
```prisma
model Document {
  id          String             @id @default(uuid())
  title       String
  content     String
  status      String             @default("draft") // draft, published
  createdAt   DateTime           @default(now())
  publishedAt DateTime?
  author      User
  editors     DocumentEditor[]
  attachments DocumentAttachment[]
}
```

### WorkLog（活动日志）
```prisma
model WorkLog {
  id          String   @id @default(uuid())
  title       String
  content     String
  status      String   @default("draft") // draft, published
  createdAt   DateTime @default(now())
  publishedAt DateTime?
  author      User
  editors     WorkLogEditor[]
  attachments WorkLogAttachment[]
}
```

### Editor（编辑者记录）
- 记录每个编辑过文档/日志的用户
- 记录最后编辑时间
- 用于显示协作编辑信息

## API路由

### 文档API
- `GET /api/documents` - 获取所有文档
- `POST /api/documents` - 创建新文档
- `GET /api/documents/[id]` - 获取单个文档
- `PATCH /api/documents/[id]` - 更新文档（仅草稿）
- `DELETE /api/documents/[id]` - 删除文档

### 活动日志API
- `GET /api/worklogs` - 获取所有活动日志
- `POST /api/worklogs` - 创建新活动日志
- `GET /api/worklogs/[id]` - 获取单个活动日志
- `PATCH /api/worklogs/[id]` - 更新活动日志（仅草稿）
- `DELETE /api/worklogs/[id]` - 删除活动日志

## 页面路由

### 文档页面
- `/documents` - 文档列表
- `/documents/new` - 新建文档
- `/documents/[id]` - 编辑/查看文档

### 活动日志页面
- `/worklogs` - 活动日志列表
- `/worklogs/new` - 新建活动日志
- `/worklogs/[id]` - 编辑/查看活动日志

## 工作流程

### 创建和编辑流程
1. 用户创建新文档/日志（自动保存为草稿）
2. 草稿状态下，所有用户都可以编辑
3. 每次编辑自动记录编辑者信息
4. 用户可以随时保存草稿
5. 准备发布时，系统提示"发布后无法修改"
6. 确认发布后，状态变为已发布
7. 已发布内容显示所有参与编辑的用户

### 权限控制
- **创建**：所有登录用户
- **编辑草稿**：所有登录用户
- **编辑已发布**：不允许
- **删除**：作者或管理员

## 用户界面

### 列表页面
- 卡片式布局
- 显示标题、内容预览、状态标签
- 显示作者、时间、编辑者信息
- 悬停显示编辑/删除按钮
- 草稿和已发布内容用不同颜色标识

### 编辑页面
- 大标题输入框
- 富文本编辑器
- 工具栏（粗体、斜体、列表等）
- 保存草稿和发布按钮
- 协作编辑状态提示
- 已发布内容只读显示

### 发布确认对话框
- 明确提示"发布后无法修改"
- 黄色警告框
- 取消和确认按钮

## 预置内容

### 2025/12/27 飞盘活动草稿
```markdown
# 飞盘活动安排

## 活动时间
2025年12月27日 下午14:00-17:00

## 活动地点
学校体育场

## 活动内容
1. 飞盘基础教学
2. 分组对抗赛
3. 自由活动时间

## 注意事项
- 请穿着运动服装和运动鞋
- 自备饮用水
- 注意安全，避免受伤

## 报名方式
请在本周五前联系组织委员报名

欢迎大家积极参与！
```

## 技术特点

### 1. 协作编辑
- 使用数据库记录编辑者
- 自动更新编辑时间
- 实时显示协作状态

### 2. 状态管理
- 草稿（draft）：可编辑
- 已发布（published）：只读

### 3. 富文本编辑
- Markdown语法支持
- 工具栏快捷操作
- 字数统计
- 响应式设计

### 4. 用户体验
- 清晰的状态提示
- 发布前警告
- 协作信息展示
- 流畅的编辑体验

## 使用说明

### 创建文档/活动日志
1. 点击导航栏的"近期文档"或"活动日志"
2. 点击"新建"按钮
3. 输入标题和内容
4. 点击"创建"保存为草稿

### 编辑草稿
1. 在列表中点击草稿卡片
2. 修改标题和内容
3. 点击"保存草稿"
4. 其他用户也可以编辑同一草稿

### 发布内容
1. 编辑完成后点击"发布"
2. 阅读警告提示
3. 确认发布
4. 内容变为只读状态

### 查看已发布内容
1. 在列表中点击已发布的卡片
2. 查看内容和参与编辑的用户
3. 无法再修改内容

## 注意事项

⚠️ **重要提示**
- 草稿状态下所有人都可以编辑，请注意协作
- 发布后内容无法修改，请仔细检查
- 只有作者和管理员可以删除内容
- 编辑记录会永久保存

## 导航更新

导航栏新增了两个入口：
- **近期文档** - 查看和编辑支部文档
- **活动日志** - 记录和查看支部活动

原有的"工作台"保持不变，可以快速访问概览信息。

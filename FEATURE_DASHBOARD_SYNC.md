# 工作台页面同步更新

## 功能概述

工作台页面现在与顶部导航栏的"近期文档"和"活动日志"完全同步，提供统一的查看体验和PDF下载功能。

## 主要更新

### 1. 数据同步
- ✅ 工作台的"近期文档"板块从API实时获取数据
- ✅ 工作台的"活动日志"板块从API实时获取数据
- ✅ 与导航栏的文档和活动日志页面数据完全一致
- ✅ 自动显示最新的3个文档和5个活动日志

### 2. 展示模式
- ✅ 工作台仅用于展示，不提供编辑功能
- ✅ 移除了"新建文档"按钮
- ✅ 移除了编辑图标
- ✅ 点击卡片打开详情弹窗（只读模式）

### 3. 详情弹窗
- ✅ 文档详情弹窗（DocumentDetailModal）
- ✅ 活动日志详情弹窗（WorkLogDetailModal）
- ✅ 显示完整内容
- ✅ 显示作者、时间、参与编辑者信息
- ✅ 支持PDF下载功能

### 4. PDF下载功能
- ✅ 点击"下载为PDF"按钮
- ✅ 自动打开浏览器打印对话框
- ✅ 格式化的PDF布局（包含标题、元信息、内容、页脚）
- ✅ 支持中文字体
- ✅ 专业的文档样式

### 5. 快速导航
- ✅ "近期文档"板块右上角"查看全部"链接
- ✅ "活动日志"板块右上角"查看全部"链接
- ✅ 点击跳转到对应的完整列表页面

## 技术实现

### 数据获取
```typescript
// 从API获取文档
const loadDocuments = async () => {
  const res = await fetch("/api/documents");
  const data = await res.json();
  setDocuments(data);
};

// 从API获取活动日志
const loadWorkLogs = async () => {
  const res = await fetch("/api/worklogs");
  const data = await res.json();
  setWorkLogs(data);
};
```

### PDF下载实现
使用浏览器原生打印功能：
1. 创建临时打印窗口
2. 生成格式化的HTML内容
3. 应用专业的CSS样式
4. 调用window.print()
5. 用户可选择"另存为PDF"

### 弹窗组件
- **DocumentDetailModal** - 文档详情弹窗
- **WorkLogDetailModal** - 活动日志详情弹窗
- 共享相同的UI设计和交互逻辑
- 响应式布局，适配不同屏幕尺寸

## 用户界面

### 工作台布局
```
┌─────────────────────────────────────────────────────┐
│ 工作台                                               │
│ 欢迎回来，XXX同志。以下是支部的最新动态。            │
├─────────────────────────────────┬───────────────────┤
│ 近期文档 [查看全部 >]            │ 活动日志 [查看全部 >] │
│                                 │                   │
│ ┌─────────────────────────┐     │ • 活动1           │
│ │ 文档标题                 │     │   作者 • 时间     │
│ │ 内容预览...              │     │                   │
│ │ 作者 • 时间 • 状态       │     │ • 活动2           │
│ └─────────────────────────┘     │   作者 • 时间     │
│                                 │                   │
│ ┌─────────────────────────┐     │ • 活动3           │
│ │ 文档标题                 │     │   作者 • 时间     │
│ │ 内容预览...              │     │                   │
│ │ 作者 • 时间 • 状态       │     │ ...               │
│ └─────────────────────────┘     │                   │
└─────────────────────────────────┴───────────────────┘
```

### 详情弹窗
```
┌─────────────────────────────────────────────────────┐
│ 文档标题                                      [X]    │
│ 作者 • 时间 • 参与编辑                              │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 文档完整内容...                                      │
│                                                     │
│                                                     │
│                                                     │
├─────────────────────────────────────────────────────┤
│                          [关闭] [下载为PDF]         │
└─────────────────────────────────────────────────────┘
```

## PDF样式

生成的PDF包含：
- **标题** - 红色主题，底部边框
- **元信息** - 灰色背景框，包含作者、时间、参与编辑者
- **正文** - 保留原始格式，自动换行
- **页脚** - 支部名称和生成日期

## 使用说明

### 查看文档
1. 登录后进入工作台
2. 在"近期文档"板块查看最新文档
3. 点击文档卡片打开详情弹窗
4. 阅读完整内容
5. 点击"下载为PDF"保存文档

### 查看活动日志
1. 在"活动日志"板块查看最新活动
2. 点击活动条目打开详情弹窗
3. 阅读完整内容
4. 点击"下载为PDF"保存日志

### 查看全部
1. 点击板块右上角的"查看全部"链接
2. 跳转到完整列表页面
3. 可以查看所有文档/活动日志
4. 可以进行编辑、删除等操作（如有权限）

## 权限说明

### 工作台页面
- **查看** - 所有登录用户
- **编辑** - 不支持（需跳转到专门页面）
- **下载PDF** - 所有登录用户

### 完整列表页面
- **查看** - 所有登录用户
- **编辑草稿** - 所有登录用户
- **发布** - 所有登录用户
- **删除** - 作者或管理员

## 数据流程

```
用户登录
  ↓
进入工作台
  ↓
加载文档和活动日志（API调用）
  ↓
显示最新内容
  ↓
用户点击查看
  ↓
打开详情弹窗
  ↓
用户下载PDF
  ↓
浏览器打印对话框
  ↓
保存为PDF文件
```

## 注意事项

### PDF下载
- 需要浏览器允许弹出窗口
- 使用浏览器原生打印功能
- 可以选择打印机或"另存为PDF"
- 支持自定义页面设置（边距、方向等）

### 性能优化
- 工作台只显示最新的几条记录
- 使用分页加载避免一次性加载过多数据
- 弹窗按需加载，不影响主页面性能

### 浏览器兼容性
- 现代浏览器（Chrome、Firefox、Edge、Safari）
- 打印功能依赖浏览器原生支持
- PDF生成质量取决于浏览器实现

## 未来改进

可能的功能增强：
- [ ] 支持导出为Word文档
- [ ] 支持批量下载
- [ ] 添加搜索和筛选功能
- [ ] 支持文档收藏
- [ ] 添加阅读进度记录
- [ ] 支持评论和讨论

## 总结

工作台现在提供了统一的文档和活动日志查看体验，用户可以：
- 快速浏览最新内容
- 查看完整详情
- 下载为PDF保存
- 跳转到完整列表进行更多操作

所有数据与导航栏页面完全同步，确保信息的一致性和实时性。
